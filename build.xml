<?xml version="1.0" encoding="UTF-8"?>
<project name="sit-wt-all" basedir="." default="all">

  <property environment="env" />
  <property name="testArtifactId" value="sit-wt-test" />
  <property name="testdir" value="${basedir}/target/${testArtifactId}" />


  <condition property="mvn.cmd" value="${env.MAVEN_HOME}\bin\mvn.cmd" else="${mvn.home}/bin/mvn">
    <os family="windows" />
  </condition>

  <target name="all" depends="01_install-parent,02_install-runtime,03_install-maven-plugin,04_install-archetype,05_create-project,06_integration-test">
  </target>

  <target name="01_install-parent">

    <exec executable="${mvn.cmd}" dir="${basedir}" failonerror="true">
      <env key="JAVA_HOME" value="${java.home}" />
      <arg value="-P release" />
      <arg value="-Dmaven.test.skip=true" />
      <arg value="-N" />
      <arg value="install" />
    </exec>

  </target>


  <target name="02_install-runtime">

    <exec executable="${mvn.cmd}" dir="${basedir}/sit-wt-runtime" failonerror="true">
      <env key="JAVA_HOME" value="${java.home}" />
      <arg value="-P release,local-test" />
      <arg value="-Dmaven.test.skip=true" />
      <arg value="install" />
    </exec>

  </target>


  <target name="03_install-maven-plugin">

    <exec executable="${mvn.cmd}" dir="${basedir}/sit-wt-maven-plugin" failonerror="true">
      <env key="JAVA_HOME" value="${java.home}" />
      <arg value="-P release,local-test" />
      <arg value="-Dmaven.test.skip=true" />
      <arg value="install" />
    </exec>

  </target>


  <target name="04_install-archetype">

    <ant antfile="${basedir}/sit-wt-project-template/distribution/build.xml" target="install" inheritall="false" />

  </target>


  <target name="05_create-project">

    <delete dir="${testdir}" />
    <mkdir dir="${testdir}"/>

    <exec executable="${mvn.cmd}" dir="${basedir}/target" failonerror="true">
      <env key="JAVA_HOME" value="${java.home}" />
      <arg value="-DarchetypeGroupId=org.sitoolkit.wt" />
      <arg value="-DarchetypeArtifactId=sit-wt-project" />
      <arg value="-DarchetypeVersion=0.9-SNAPSHOT" />
      <arg value="-DgroupId=a.b.c" />
      <arg value="-DartifactId=${testArtifactId}" />
      <arg value="-Darchetype.interactive=false" />
      <arg value="-DarchetypeCatalog=local" />
      <arg value="-B" />
      <arg value="archetype:generate" />
    </exec>

  </target>

  <target name="06_integration-test">

    <copy file="${basedir}/sit-wt-runtime/seleniumscript/SeleniumIDETestScript.html" todir="${testdir}/seleniumscript" />
    <copy file="${basedir}/sit-wt-runtime/testscript/ExcelTestScript.xlsx" todir="${testdir}/testscript" />

    <exec executable="${mvn.cmd}" dir="${testdir}" failonerror="true">
      <env key="JAVA_HOME" value="${java.home}" />
      <arg value="-DbaseUrl=http://localhost:8280" />
      <arg value="integration-test" />
    </exec>

  </target>

</project>
